Года с 2016 для своих собственных хобби и для помощи чужим некоммерческим проектам использую GCP, но Google признался в шовинизме, русофобии и ввел дискриминационные ограничения на людей, в число которых вхожу я. Даже то, что я украинец, не имеет значения, ведь под ненавистными русскими они подразумевают всю культуру, всех славян, всех пользователей кириллицы.

# Переезд с Google Cloud (GCP) на Yandex Cloud (YC)

Здесь будет обзор примера примера переезда, а также заметки, ответы на вопросы, которые могут возникать в процессе.

## Disclaimer

Я не специалист ни по переносу облаков, ни по Яндекс Облаку, ни по AWS-совместимым инструментам, так что советы приветствуются.

![dog](https://user-images.githubusercontent.com/2870363/159172571-361753a7-3516-4a0b-9726-c139c0ba5c54.jpg)

## Тарификация и Free Tier

> 17 марта 2022: <Нарек Татевосян> Free Tier для Compute не планируется.

## Сервисы

### Storage -> Object Storage

https://cloud.google.com/storage/pricing  
https://cloud.yandex.ru/docs/storage/pricing

|                | Google      | Yandex  |
| -------------- | :---------: | :-----: |
| Free GB-months | 5           | 1       |

Т.к. переносить я буду не все, делать я это буду в два этапа, поэтому единого скрипта не будет.

Отсортировать бакеты по размеру: `$ gsutil du -s gs://* | sort -nr`  
Скачать: `$ gsutil mv gs://.../* ~/_/...`  

https://cloud.google.com/storage/docs/gsutil/commands/mv#renaming-groups-of-objects  
Перед `mv` можно добавить `-m`, чтобы качало параллельно.  
`*` в src аргументе gsutil не может указывать на директории, только на файлы.  
Если использовать не `gsutil mv`, а `gsutil rsync`, то можно обойтись без звездочки:  
```
$ mkdir ~/_/my_bucket
$ gsutil -m rsync -r gs://my_bucket ~/_/my_bucket/
$ gsutil -m rm -r gs://my_bucket/*  # м.б. удаление бакета целиком затратит меньше платных операций
```

Деплой в Run и Functions захламляет бакет с названием типа `[<region>.]artifacts.<projectname>.appspot.com` -- он нужен для того, чтоб восстанавливать образы прошлых версий. Чистить его [рекомендуют](https://stackoverflow.com/a/67693952/322020) не вручную, а через https://console.cloud.google.com/gcr хотя найти там что-либо проблематично -- я нашел файлы, совпадающие по дате, удалил, а в бакете они остались. Не знаю, почему нет ни обратных ссылок, ни поиска в реестре по имени/хешу. Единственное наверное, что можно еще сделать -- скачать образ, как-то скормить докеру и посмотреть, что внутри.

### Datastore -> ?

### Run -> ?

### Functions -> Cloud Functions

### Pub/Sub -> ?

### Compute Engine -> Compute Cloud

### Scheduler -> ?

### Logging -> ?

### Error Reporting -> ?
